# Terraform AWS & K3s Lab (Separated)

The project is split into two parts to avoid state dependency hell:
1. **Infra**: AWS Resources (VPC, EC2, S3, RDS, Cognito)
2. **Apps**: Kubernetes Resources (Deployments, Services, Ingress)

## Prerequisites
ssh-keygen -t ed25519 -f .ssh/terraform-lab -N ""

## Step 1: Provision AWS Infrastructure
```bash
# Init and Apply Infra
docker compose run --rm -w /projects/terraform-course-lab/infra terraform -c "terraform init"
docker compose run --rm -w /projects/terraform-course-lab/infra terraform -c "terraform apply -auto-approve"
```

## Step 2: Provision Kubernetes Resources
Once the EC2 is up and K3s is running:
```bash
# Init and Apply Apps
docker compose run --rm -w /projects/terraform-course-lab/apps terraform -c "terraform init"
docker compose run --rm -w /projects/terraform-course-lab/apps terraform -c "terraform apply -auto-approve"
```

## Maintenance
- To update AWS settings, work in `infra/`.
- To update K8s settings, work in `apps/`.
- No more "Connection Refused" errors when updating AWS!

## Clean up
```bash
# Destroy Apps first
docker compose run --rm -w /projects/terraform-course-lab/apps terraform -c "terraform destroy"

# Then Destroy Infra
docker compose run --rm -w /projects/terraform-course-lab/infra terraform -c "terraform destroy"
```
